# سامانه مدیریت عملکرد پرسنل اورژانس - ویژگی‌های جدید

## تاریخ بروزرسانی: ۱۴۰۳/۷/۱۳

---

## 📋 فهرست تغییرات

### ۱. بخش مدیریت پرسنل (Personnel Management)

#### ✅ تفکیک فیلد نام

**قبل از بروزرسانی:**
- یک فیلد واحد: "نام و نام خانوادگی"

**بعد از بروزرسانی:**
- فیلد ۱: **نام** (First Name) - اجباری
- فیلد ۲: **نام خانوادگی** (Last Name) - اختیاری

**مزایا:**
- امکان جستجو و فیلتر دقیق‌تر بر اساس نام یا نام خانوادگی
- سازماندهی بهتر داده‌ها
- انعطاف‌پذیری بیشتر در گزارش‌گیری

#### ✅ افزودن فیلد سابقه کاری

**فیلد جدید:** سابقه کاری (Work Experience)

**گزینه‌های موجود:**
- ۰ تا ۴ سال
- ۴ تا ۸ سال
- ۸ تا ۱۲ سال
- ۱۲ تا ۱۶ سال
- ۱۶ سال به بالا

**کاربردها:**
- فیلتر کردن پرسنل بر اساس سابقه
- تحلیل توزیع تجربه در سازمان
- برنامه‌ریزی منابع انسانی

---

### ۲. بخش نظارت بر عملکرد (Performance Monitoring)

#### ✅ قابلیت ویرایش شیفت با کلیک (Shift Editing Modal)

**نحوه استفاده:**
1. روی دکمه "فعال‌سازی ویرایش" کلیک کنید
2. روی هر مربع روز در جدول کلیک کنید
3. پنجره انتخاب شیفت باز می‌شود
4. شیفت‌های مورد نظر را انتخاب کنید (امکان انتخاب چند شیفت)
5. روی "تأیید" کلیک کنید

**دسته‌بندی شیفت‌ها:**
- **شیفت کاری**: شیفت‌های عادی کاری
- **مرخصی**: انواع مرخصی
- **متفرقه**: سایر موارد

#### ✅ دکمه‌های عملیاتی جدید

**۱. ذخیره (Save)**
- ذخیره تغییرات فعلی
- قابل ویرایش در آینده

**۲. ذخیره موقت (Temporary Save)**
- ذخیره موقت برای ادامه کار بعدی
- حفظ پیش‌نویس

**۳. ذخیره نهایی (Final Save)**
- قطعی کردن داده‌ها
- عدم امکان ویرایش (بر اساس سیاست سازمان)

**۴. فعال‌سازی ویرایش (Edit Mode)**
- فعال/غیرفعال کردن حالت ویرایش
- جلوگیری از تغییرات ناخواسته

#### ✅ انتخاب حالت نمایش جدول

**سه حالت نمایش:**

**حالت ۱: فقط کد شیفت**
```
┌─────┐
│  A  │
└─────┘
```

**حالت ۲: عنوان + کد شیفت**
```
┌─────────┐
│ صبح     │
│   A     │
└─────────┘
```

**حالت ۳: عنوان + کد + پایگاه**
```
┌─────────┐
│ صبح     │
│   A     │
│ پایگاه۱ │
└─────────┘
```

#### ✅ قابلیت Undo/Redo

**دکمه بازگشت (Undo):**
- بازگشت به مرحله قبل
- حفظ تاریخچه تغییرات

**دکمه پیش‌روی (Redo):**
- بازگشت به مرحله بعد از Undo
- بازیابی تغییرات لغو شده

**ویژگی‌ها:**
- تاریخچه کامل تغییرات
- امکان بازگشت چندین مرحله
- جلوگیری از از دست رفتن داده‌ها

#### ✅ ستون‌های انتهایی جدول

**۷ ستون خلاصه اطلاعات:**

| ردیف | عنوان ستون | توضیحات |
|------|------------|---------|
| ۱ | موظفی عملکرد | محاسبه موظفی کلی |
| ۲ | جمع عملکرد ماهانه | مجموع ساعات کاری |
| ۳ | مجموع مرخصی | مجموع مرخصی‌ها |
| ۴ | مجموع تعطیلات | تعطیلات رسمی |
| ۵ | اضافه کار | ساعات اضافه‌کاری |
| ۶ | تعداد مأموریت | تعداد مأموریت‌ها |
| ۷ | تعداد وعده غذا | تعداد وعده‌های غذا |

**رنگ‌بندی ستون‌ها:**
- آبی: موظفی و جمع عملکرد
- سبز: مرخصی
- زرد: تعطیلات
- بنفش: اضافه کار
- نارنجی: مأموریت
- صورتی: وعده غذا

#### ✅ قابلیت Hide/Unhide ستون‌ها

**نحوه استفاده:**
1. در بخش "نمایش/مخفی کردن ستون‌ها" 
2. تیک هر ستون را بزنید یا بردارید
3. ستون‌ها به صورت خودکار نمایش/مخفی می‌شوند

**مزایا:**
- کاهش شلوغی جدول
- تمرکز روی اطلاعات مهم
- سفارشی‌سازی نمایش

#### ✅ تخصیص شیفت ویژه گروهی (Batch Assignment)

**دو روش انتخاب پرسنل:**

**الف) انتخاب دستی:**
1. جستجوی پرسنل با نام
2. تیک زدن افراد مورد نظر
3. امکان انتخاب تک‌به‌تک

**ب) انتخاب فیلتری:**

**فیلترهای موجود:**

| فیلتر | گزینه‌ها |
|-------|---------|
| بهره‌وری | بهره‌ور / غیر بهره‌ور |
| وضعیت استخدامی | رسمی / طرحی |
| سابقه کاری | ۰-۴ / ۴-۸ / ۸-۱۲ / ۱۲-۱۶ / ۱۶+ سال |
| پایگاه | انتخاب از لیست پایگاه‌ها |
| نوع شیفت | شیفت‌های خاص |
| تعداد شیفت | کمتر/بیشتر از تعداد مشخص |
| مجموع ستون‌های انتهایی | بر اساس آمار |

**نحوه استفاده:**
1. روی "تخصیص دسته جمعی" کلیک کنید
2. روش انتخاب را مشخص کنید (دستی یا فیلتری)
3. پرسنل مورد نظر را انتخاب کنید
4. شیفت مورد نظر را انتخاب کنید
5. روی "تخصیص جمعی" کلیک کنید

**مثال کاربردی:**
- تخصیص شیفت شب به همه پرسنل بهره‌ور با سابقه بیش از ۸ سال
- تخصیص مرخصی به پرسنل پایگاه خاص
- تخصیص شیفت خاص به افراد دارای کمترین ساعت کاری

---

## 🗄️ تغییرات دیتابیس

### جدول Personnel

**ستون‌های جدید:**
```sql
first_name    TEXT NOT NULL     -- نام
last_name     TEXT              -- نام خانوادگی  
work_experience TEXT            -- سابقه کاری
```

**محدودیت‌ها:**
- `first_name`: اجباری
- `work_experience`: فقط مقادیر مجاز ('0-4', '4-8', '8-12', '12-16', '16+')

### مایگریشن خودکار

برای اجرای مایگریشن، فایل `DATABASE_MIGRATION_INSTRUCTIONS.md` را مشاهده کنید.

---

## 🚀 نحوه استفاده از سیستم

### ۱. راه‌اندازی اولیه

```bash
# نصب وابستگی‌ها
cd /home/user/webapp
npm install

# اجرای مایگریشن دیتابیس
# (طبق دستورالعمل DATABASE_MIGRATION_INSTRUCTIONS.md)

# ساخت پروژه
npm run build

# اجرای سرور توسعه
pm2 start ecosystem.config.cjs
```

### ۲. ورود به سیستم

**اطلاعات ورود مدیر:**
- نام کاربری: `admin`
- رمز عبور: `admin1`

### ۳. استفاده از قابلیت‌های جدید

#### مدیریت پرسنل:
1. از منوی اصلی، "مدیریت پرسنل" را انتخاب کنید
2. روی "افزودن پرسنل جدید" کلیک کنید
3. نام و نام خانوادگی را جداگانه وارد کنید
4. سابقه کاری را انتخاب کنید
5. سایر اطلاعات را کامل کنید

#### نظارت بر عملکرد:
1. از منوی اصلی، "نظارت بر عملکرد" را انتخاب کنید
2. ماه و سال را انتخاب کنید
3. روی "اعمال فیلتر" کلیک کنید
4. از قابلیت‌های جدید استفاده کنید:
   - ویرایش شیفت با کلیک
   - تخصیص دسته جمعی
   - تغییر حالت نمایش
   - استفاده از Undo/Redo
   - مخفی/نمایش ستون‌ها

---

## 🔧 تکنولوژی‌های استفاده شده

- **Frontend**: React 19, TypeScript, TailwindCSS
- **Backend**: Supabase (Auth + PostgreSQL Database)
- **Build Tool**: Vite
- **State Management**: React Context API
- **UI Components**: Custom Components with TailwindCSS

---

## 📊 آمار سیستم

### قابلیت‌های مدیریت پرسنل:
- ✅ تعداد فیلدهای جدید: 2 (نام و نام خانوادگی)
- ✅ تعداد گزینه‌های سابقه کاری: 5
- ✅ تعداد ستون‌های جدول: 8

### قابلیت‌های نظارت بر عملکرد:
- ✅ تعداد حالت‌های نمایش: 3
- ✅ تعداد ستون‌های خلاصه: 7
- ✅ تعداد دکمه‌های عملیاتی: 4
- ✅ تعداد فیلترهای تخصیص گروهی: 7+
- ✅ قابلیت Undo/Redo: ✓

---

## 🐛 رفع مشکلات رایج

### خطای "Column does not exist"
**علت**: مایگریشن دیتابیس اجرا نشده است
**راه‌حل**: فایل `DATABASE_MIGRATION_INSTRUCTIONS.md` را دنبال کنید

### دکمه‌ها کار نمی‌کنند
**علت**: حالت ویرایش فعال نیست
**راه‌حل**: روی دکمه "فعال‌سازی ویرایش" کلیک کنید

### ستون‌ها نمایش داده نمی‌شوند
**علت**: ستون‌ها مخفی شده‌اند
**راه‌حل**: از بخش "نمایش/مخفی کردن ستون‌ها" استفاده کنید

### تخصیص دسته جمعی کار نمی‌کند
**علت**: پرسنل یا شیفت انتخاب نشده است
**راه‌حل**: حتماً پرسنل و شیفت را انتخاب کنید

---

## 📞 پشتیبانی

برای هرگونه سوال یا مشکل:
1. فایل‌های مستندات را بررسی کنید
2. فایل‌های تست را اجرا کنید
3. Console برو وزر را بررسی کنید

---

## 📝 یادداشت‌های مهم

1. **حتماً مایگریشن دیتابیس را اجرا کنید** قبل از استفاده از قابلیت‌های جدید
2. **تست کنید** همه قابلیت‌ها را قبل از استفاده در محیط واقعی
3. **نسخه پشتیبان** از دیتابیس تهیه کنید قبل از مایگریشن
4. **مرورگر را رفرش کنید** بعد از بروزرسانی کد

---

## ✅ چک‌لیست پیاده‌سازی

- [x] تفکیک فیلد نام در مدیریت پرسنل
- [x] افزودن فیلد سابقه کاری
- [x] قابلیت ویرایش شیفت با کلیک
- [x] دکمه‌های ذخیره، ذخیره موقت، ذخیره نهایی
- [x] حالت‌های نمایش مختلف جدول
- [x] قابلیت Undo/Redo
- [x] ستون‌های انتهایی خلاصه
- [x] قابلیت Hide/Unhide ستون‌ها
- [x] تخصیص شیفت ویژه گروهی
- [x] فیلترهای پیشرفته
- [x] مایگریشن دیتابیس
- [x] مستندات کامل

---

**تاریخ به‌روزرسانی**: ۱۴۰۳/۷/۱۳  
**نسخه**: 2.0.0  
**وضعیت**: ✅ آماده استفاده
